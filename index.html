<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leslie Speech Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #ffffff;
            color: #000000;
            padding: 16px;
        }

        .container {
            max-width: 100vw;
            min-height: 100vh;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin-bottom: 16px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: bold;
            color: #0099cc;
            flex-grow: 1;
            text-align: center;
        }

        .settings-btn {
            width: 48px;
            height: 48px;
            background: transparent;
            border: none;
            cursor: pointer;
            border-radius: 50%;
            font-size: 20px;
        }

        /* Pages */
        .page {
            display: none;
            width: 100%;
        }

        .page.active {
            display: block;
        }

        /* Home Page */
        .home-page {
            text-align: center;
            padding: 16px;
        }

        .welcome-text {
            font-size: 18px;
            margin-bottom: 32px;
            line-height: 1.5;
        }

        .main-button {
            width: 100%;
            height: 80px;
            font-size: 20px;
            font-weight: bold;
            color: white;
            border: none;
            border-radius: 8px;
            margin-bottom: 24px;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .btn-talking { background-color: #0099cc; }
        .btn-texting { background-color: #9933cc; }
        .btn-phone { background-color: #669900; }
        .btn-commands { background-color: #ff8800; }

        /* Page Headers */
        .page-header {
            display: flex;
            align-items: center;
            padding: 16px;
            color: white;
            margin-bottom: 16px;
            border-radius: 8px;
        }

        .page-header h2 {
            flex-grow: 1;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
        }

        .close-btn {
            width: 48px;
            height: 48px;
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 50%;
            font-size: 24px;
        }

        .header-speech { background-color: #0099cc; }
        .header-phone { background-color: #669900; }
        .header-commands { background-color: #ff8800; }
        .header-text { background-color: #9933cc; }
        .header-settings { background-color: #0099cc; }

        /* Speech Page */
        .status-text {
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            color: #0099cc;
            margin-bottom: 16px;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .speech-display {
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
            min-height: 200px;
            background-color: #f9f9f9;
        }

        .speech-text {
            font-size: 18px;
            line-height: 1.4;
            color: #000;
        }

        .control-row {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin: 16px 0;
        }

        .control-btn {
            height: 70px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            padding: 0 24px;
        }

        .btn-listen { background-color: #0099cc; }
        .btn-stop { background-color: #cc0000; }
        .btn-clear { background-color: #ffaa00; }

        /* Text Input */
        .text-input-content {
            padding: 16px;
        }

        .speak-btn-container {
            margin-bottom: 16px;
            text-align: right;
        }

        .speak-btn {
            background: #9933cc;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
        }

        .speak-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .text-input {
            width: 100%;
            padding: 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 18px;
            min-height: 300px;
            resize: vertical;
        }

        /* Contacts */
        .contact-search {
            padding: 16px;
            background-color: #f0f0f0;
        }

        .contact-search input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #669900;
            border-radius: 8px;
        }

        .contacts-list {
            border: 2px solid #ddd;
            border-radius: 8px;
            margin: 16px;
            max-height: 400px;
            overflow-y: auto;
            background-color: white;
        }

        .contact-item {
            padding: 16px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }

        .contact-item:hover {
            background-color: #f0f0f0;
        }

        .contact-name {
            font-weight: bold;
            font-size: 16px;
        }

        .contact-phone {
            color: #666;
            font-size: 14px;
            margin-top: 4px;
        }

        /* Commands Page */
        .commands-content {
            padding: 16px;
            max-height: 500px;
            overflow-y: auto;
        }

        .commands-text {
            font-size: 14px;
            line-height: 1.5;
        }

        /* Settings */
        .settings-content {
            padding: 16px;
        }

        .setting-item {
            background-color: #f9f9f9;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .setting-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        /* Buttons */
        .btn-home {
            background-color: #0099cc;
            height: 60px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: 200px;
            margin: 16px auto;
            display: block;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-button {
                height: 70px;
                font-size: 18px;
            }
            
            .control-btn {
                height: 60px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div style="width: 48px;"></div>
            <h1>Leslie Speech Assistant</h1>
            <button class="settings-btn" onclick="showPage('settings')">‚öôÔ∏è</button>
        </div>

        <!-- Home Page -->
        <div id="homePage" class="page active">
            <div class="home-page">
                <div class="welcome-text">
                    üëã Welcome to Leslie!<br><br>Choose what you'd like to do:
                </div>
                
                <button class="main-button btn-talking" onclick="showPage('speech')">
                    üé§ START TALKING
                </button>

                <button class="main-button btn-texting" onclick="showPage('textInput')">
                    üìù START TEXTING
                </button>
                
                <button class="main-button btn-phone" onclick="showPage('phone')">
                    üìû PHONE CALL
                </button>
                
                <button class="main-button btn-commands" onclick="showPage('commands')">
                    üó£Ô∏è LESLIE COMMANDS
                </button>
            </div>
        </div>

        <!-- Speech Recognition Page -->
        <div id="speechPage" class="page">
            <div class="page-header header-speech">
                <h2>üé§ Speech Recognition</h2>
                <button class="close-btn" onclick="showPage('home')">&times;</button>
            </div>
            
            <div class="status-text" id="statusText">
                Ready to listen - Click "START TALKING" below
            </div>
            
            <div class="speech-display">
                <div class="speech-text" id="speechText">
                    Your speech will appear here...
                </div>
            </div>
            
            <div class="control-row">
                <button class="control-btn btn-listen" id="listenButton" onclick="toggleListening()">
                    START TALKING
                </button>
                <button class="control-btn btn-clear" onclick="clearText()">
                    CLEAR
                </button>
            </div>
        </div>

        <!-- Text Input Page -->
        <div id="textInputPage" class="page">
            <div class="page-header header-text">
                <h2>üìù Text Input</h2>
                <button class="close-btn" onclick="showPage('home')">&times;</button>
            </div>
            
            <div class="text-input-content">
                <div class="speak-btn-container">
                    <button class="speak-btn" id="speakTextBtn" onclick="speakText()">
                        üîä SPEAK TEXT
                    </button>
                </div>
                
                <textarea class="text-input" id="textInput" 
                          placeholder="Type your message here..." 
                          oninput="updateSpeakButton()"></textarea>
            </div>
            
            <button class="btn-home" onclick="showPage('home')">üè† HOME</button>
        </div>

        <!-- Phone Page -->
        <div id="phonePage" class="page">
            <div class="page-header header-phone">
                <h2>üìû Your Contacts</h2>
                <button class="close-btn" onclick="showPage('home')">&times;</button>
            </div>
            
            <div class="contact-search">
                <input type="text" placeholder="Search contacts..." 
                       oninput="filterContacts(this.value)">
            </div>
            
            <div class="contacts-list" id="contactsList">
                <div style="padding: 20px; text-align: center; color: #666;">
                    <p>No contacts loaded.</p>
                    <button onclick="loadContacts()" 
                            style="margin-top: 10px; padding: 10px 20px; background: #669900; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        Load Contacts
                    </button>
                </div>
            </div>
            
            <button class="btn-home" onclick="showPage('home')">üè† HOME</button>
        </div>

        <!-- Commands Page -->
        <div id="commandsPage" class="page">
            <div class="page-header header-commands">
                <h2>üó£Ô∏è Leslie Commands</h2>
                <button class="close-btn" onclick="showPage('home')">&times;</button>
            </div>
            
            <div class="commands-content">
                <div class="commands-text">
                    <strong>Available Voice Commands:</strong><br><br>
                    
                    <strong>‚Ä¢ "Hey Leslie, what time is it?"</strong><br>
                    - Tells you the current time<br><br>
                    
                    <strong>‚Ä¢ "Hey Leslie, what's the date?"</strong><br>
                    - Tells you today's date<br><br>
                    
                    <strong>‚Ä¢ "Hey Leslie, start talking"</strong><br>
                    - Goes to speech recognition page<br><br>
                    
                    <strong>‚Ä¢ "Hey Leslie, go home"</strong><br>
                    - Returns to the main menu<br><br>
                    
                    <strong>‚Ä¢ "Hey Leslie, help"</strong><br>
                    - Shows this commands list<br><br>
                    
                    <strong>Tips:</strong><br>
                    ‚Ä¢ Allow microphone permission when prompted<br>
                    ‚Ä¢ Voice commands work from any page<br>
                    ‚Ä¢ Speak clearly for best results
                </div>
            </div>
            
            <button class="btn-home" onclick="showPage('home')">üè† HOME</button>
        </div>

        <!-- Settings Page -->
        <div id="settingsPage" class="page">
            <div class="page-header header-settings">
                <h2>‚öôÔ∏è Settings</h2>
                <button class="close-btn" onclick="showPage('home')">&times;</button>
            </div>
            
            <div class="settings-content">
                <div class="setting-item">
                    <div class="setting-title">Speech Speed</div>
                    <input type="range" min="0.5" max="2" step="0.1" value="1" 
                           onchange="updateSpeechSpeed(this.value)">
                    <div id="speedValue">Normal (1.0x)</div>
                </div>
                
                <div class="setting-item">
                    <div class="setting-title">Voice Commands</div>
                    <label>
                        <input type="checkbox" checked onchange="updateVoiceCommands(this.checked)">
                        Enable voice command responses
                    </label>
                </div>
            </div>
            
            <button class="btn-home" onclick="showPage('home')">üè† HOME</button>
        </div>
    </div>

    <script>
        // Global variables
        let recognition = null;
        let isListening = false;
        let currentPage = 'home';
        let contacts = [];
        let filteredContacts = [];
        let speechSpeed = 1.0;
        let voiceCommandsEnabled = true;

        // Initialize app
        function initApp() {
            console.log('Initializing Leslie...');
            
            // Check for speech recognition support
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('Speech recognition not supported. Please use Chrome, Edge, or Safari.');
                return;
            }

            setupSpeechRecognition();
            setupVoiceCommands();
            console.log('Leslie initialized successfully');
        }

        // Setup speech recognition
        function setupSpeechRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            
            recognition.continuous = true;
            recognition.interimResults = true;
            recognition.lang = 'en-US';
            
            recognition.onstart = function() {
                isListening = true;
                updateUI();
                updateStatus('üé§ Listening... Say something!');
            };
            
            recognition.onend = function() {
                if (isListening) {
                    // Auto-restart if we should still be listening
                    setTimeout(() => {
                        if (isListening) {
                            try {
                                recognition.start();
                            } catch (e) {
                                console.log('Recognition restart failed');
                                isListening = false;
                                updateUI();
                                updateStatus('Ready to listen - Click "START TALKING"');
                            }
                        }
                    }, 100);
                } else {
                    updateStatus('Ready to listen - Click "START TALKING"');
                    updateUI();
                }
            };
            
            recognition.onerror = function(event) {
                console.error('Speech recognition error:', event.error);
                updateStatus('Recognition error. Please try again.');
            };
            
            recognition.onresult = function(event) {
                let finalTranscript = '';
                let interimTranscript = '';
                
                for (let i = 0; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript;
                    } else {
                        interimTranscript += transcript;
                    }
                }
                
                const displayText = finalTranscript || interimTranscript;
                document.getElementById('speechText').textContent = displayText || 'Your speech will appear here...';
                
                if (finalTranscript) {
                    updateStatus('‚úÖ Heard: ' + finalTranscript);
                    // Speak back the text
                    setTimeout(() => speakText(finalTranscript), 500);
                }
            };
        }

        // Setup voice commands
        function setupVoiceCommands() {
            // This would be a separate recognition instance for global commands
            // Simplified for now - voice commands would work when not actively using speech page
        }

        // Page navigation
        function showPage(pageId) {
            console.log('Showing page:', pageId);
            
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show requested page
            const targetPage = document.getElementById(pageId + 'Page');
            if (targetPage) {
                targetPage.classList.add('active');
                currentPage = pageId;
                
                // Stop listening when leaving speech page
                if (pageId !== 'speech' && isListening) {
                    stopListening();
                }
                
                // Auto-focus text input
                if (pageId === 'textInput') {
                    setTimeout(() => {
                        const textInput = document.getElementById('textInput');
                        if (textInput) {
                            textInput.focus();
                        }
                    }, 100);
                }
            }
        }

        // Speech functions
        function toggleListening() {
            if (isListening) {
                stopListening();
            } else {
                startListening();
            }
        }

        function startListening() {
            if (recognition) {
                try {
                    recognition.start();
                } catch (error) {
                    console.error('Error starting recognition:', error);
                    updateStatus('Error starting recognition. Please try again.');
                }
            }
        }

        function stopListening() {
            if (recognition && isListening) {
                isListening = false;
                recognition.stop();
                updateStatus('Stopped listening');
                updateUI();
            }
        }

        function clearText() {
            document.getElementById('speechText').textContent = 'Your speech will appear here...';
            updateStatus('Text cleared - Ready to listen');
        }

        function updateUI() {
            const listenButton = document.getElementById('listenButton');
            if (listenButton) {
                if (isListening) {
                    listenButton.textContent = 'STOP LISTENING';
                    listenButton.className = 'control-btn btn-stop';
                } else {
                    listenButton.textContent = 'START TALKING';
                    listenButton.className = 'control-btn btn-listen';
                }
            }
        }

        function updateStatus(message) {
            const statusEl = document.getElementById('statusText');
            if (statusEl) {
                statusEl.textContent = message;
            }
        }

        // Text input functions
        function speakText(text) {
            if (!text) {
                const textInput = document.getElementById('textInput');
                text = textInput ? textInput.value : '';
            }
            
            if (text.trim() && voiceCommandsEnabled) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = speechSpeed;
                utterance.pitch = 1;
                utterance.volume = 0.8;
                window.speechSynthesis.speak(utterance);
            }
        }

        function updateSpeakButton() {
            const textInput = document.getElementById('textInput');
            const speakBtn = document.getElementById('speakTextBtn');
            if (speakBtn && textInput) {
                speakBtn.disabled = !textInput.value.trim();
            }
        }

        // Contact functions
        function loadContacts() {
            // Try to load real contacts
            if ('contacts' in navigator && 'ContactsManager' in window) {
                navigator.contacts.select(['name', 'tel'], {multiple: true})
                    .then(contactList => {
                        contacts = contactList.map(contact => ({
                            name: contact.name[0] || 'Unknown',
                            phone: contact.tel[0] || 'No phone'
                        }));
                        filteredContacts = [...contacts];
                        displayContacts();
                    })
                    .catch(error => {
                        console.log('Contact access error:', error);
                        alert('Contact access not available in this browser.');
                    });
            } else {
                alert('Contact access not supported in this browser.');
            }
        }

        function displayContacts() {
            const contactsList = document.getElementById('contactsList');
            contactsList.innerHTML = '';
            
            if (filteredContacts.length === 0) {
                contactsList.innerHTML = '<div style="padding: 20px; text-align: center; color: #666;">No contacts found.</div>';
                return;
            }
            
            filteredContacts.forEach(contact => {
                const contactEl = document.createElement('div');
                contactEl.className = 'contact-item';
                contactEl.innerHTML = `
                    <div class="contact-name">${contact.name}</div>
                    <div class="contact-phone">${contact.phone}</div>
                `;
                contactEl.onclick = () => callContact(contact);
                contactsList.appendChild(contactEl);
            });
        }

        function filterContacts(searchTerm) {
            if (!searchTerm.trim()) {
                filteredContacts = [...contacts];
            } else {
                const searchLower = searchTerm.toLowerCase();
                filteredContacts = contacts.filter(contact => 
                    contact.name.toLowerCase().includes(searchLower) ||
                    contact.phone.includes(searchTerm)
                );
            }
            displayContacts();
        }

        function callContact(contact) {
            window.location.href = `tel:${contact.phone.replace(/[^0-9]/g, '')}`;
        }

        // Settings functions
        function updateSpeechSpeed(value) {
            speechSpeed = parseFloat(value);
            const label = document.getElementById('speedValue');
            if (label) {
                if (value == 1.0) {
                    label.textContent = 'Normal (1.0x)';
                } else {
                    label.textContent = value + 'x';
                }
            }
        }

        function updateVoiceCommands(enabled) {
            voiceCommandsEnabled = enabled;
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
