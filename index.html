// Setup voice command listener (always listening for "Hey Leslie")
        function setupVoiceCommandListener() {
            if (!microphonePermissionGranted) {
                console.log('No microphone permission for voice commands');
                return;
            }
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                console.log('Speech Recognition not supported');
                return;
            }

            const voiceCommandRecognition = new SpeechRecognition();
            voiceCommandRecognition.continuous = true;
            voiceCommandRecognition.interimResults = false;
            voiceCommandRecognition.lang = 'en-US';
            
            let isVoiceCommandActive = false;
            
            voiceCommandRecognition.onstart = function() {
                isVoiceCommandActive = true;
                console.log('Voice command recognition started');
            };
            
            voiceCommandRecognition.onresult = function(event) {
                for (let i = event.resultIndex; i < event.results.length; i++) {
                    if (event.results[i].isFinal) {
                        const transcript = event.results[i][0].transcript.toLowerCase().trim();
                        console.log('Voice command heard:', transcript);
                        
                        // More flexible "Hey Leslie" detection
                        if (transcript.includes('hey leslie') || transcript.includes('leslie')) {
                            processVoiceCommand(transcript);
                        }
                    }
                }
            };
            
            voiceCommandRecognition.onerror = function(event) {
                console.log('Voice command error:', event.error);
                isVoiceCommandActive = false;
                
                // Don't restart on certain errors
                if (event.error === 'not-allowed' || event.error === 'service-not-allowed') {
                    console.log('Voice command permission denied');
                    return;
                }
                
                // Restart after error
                setTimeout(startVoiceCommandListening, 3000);
            };
            
            voiceCommandRecognition.onend = function() {
                console.log('Voice command recognition ended');
                isVoiceCommandActive = false;
                
                // Restart if we should be listening and not on speech page actively listening
                if (currentPage !== 'speech' || !isListening) {
                    setTimeout(startVoiceCommandListening, 2000);
                }
            };

            function startVoiceCommandListening() {
                // Only start if we're not on speech page with active listening
                if ((currentPage !== 'speech' || !isListening) && microphonePermissionGranted && !isVoiceCommandActive) {
                    try {
                        voiceCommandRecognition.start();
                    } catch (error) {
                        console.log('Voice command recognition start failed:', error);
                        isVoiceCommandActive = false;
                    }
                }
            }

            // Start voice command listening
            startVoiceCommandListening();
            
            // Periodically ensure voice commands are active (every 45 seconds)
            setInterval(() => {
                if (!isVoiceCommandActive && (currentPage !== 'speech' || !isListening)) {
                    console.log('Restarting voice command recognition');
                    startVoiceCommandListening();
                }
            }, 45000);
        }
