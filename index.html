<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Voice Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: bold;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .warning { background: #fff3cd; color: #856404; }
        button {
            padding: 15px 30px;
            margin: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }
        .btn-start { background: #28a745; color: white; }
        .btn-stop { background: #dc3545; color: white; }
        .btn-test { background: #007bff; color: white; }
        .log {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üé§ Simple Voice Command Test</h1>
    
    <div class="status info">
        <strong>Test Plan:</strong><br>
        1. Click "Test Microphone Permission"<br>
        2. Allow microphone when prompted<br>
        3. Click "Start Voice Recognition"<br>
        4. Say "hello test" or "leslie test"<br>
        5. Check what gets detected
    </div>

    <div>
        <button class="btn-test" onclick="testMicrophone()">Test Microphone Permission</button>
        <button class="btn-start" onclick="startSimpleVoice()" id="startBtn">Start Voice Recognition</button>
        <button class="btn-stop" onclick="stopVoice()" id="stopBtn" style="display:none;">Stop Voice Recognition</button>
    </div>

    <div id="status" class="status info">Ready to test</div>
    
    <div class="log" id="log">Waiting for test to start...</div>

    <h3>üîß System Information:</h3>
    <div class="log" id="systemInfo"></div>

    <script>
        let recognition = null;
        let isListening = false;

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('log');
            logDiv.textContent += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }

        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
        }

        function updateSystemInfo() {
            const info = document.getElementById('systemInfo');
            const hasWebkit = 'webkitSpeechRecognition' in window;
            const hasSpeech = 'SpeechRecognition' in window;
            const protocol = location.protocol;
            const userAgent = navigator.userAgent;
            
            info.textContent = `Browser: ${userAgent}
Protocol: ${protocol}
webkitSpeechRecognition: ${hasWebkit ? 'Available' : 'Not Available'}
SpeechRecognition: ${hasSpeech ? 'Available' : 'Not Available'}
Recognition Object: ${recognition ? 'Created' : 'Not Created'}
Is Listening: ${isListening}`;
        }

        async function testMicrophone() {
            log('Testing microphone permission...');
            updateStatus('Testing microphone permission...', 'info');
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                log('‚úÖ Microphone permission granted!');
                updateStatus('‚úÖ Microphone permission granted!', 'success');
                
                // Stop the stream
                stream.getTracks().forEach(track => track.stop());
                log('Microphone stream stopped');
                
            } catch (error) {
                log(`‚ùå Microphone permission error: ${error.name} - ${error.message}`);
                updateStatus(`‚ùå Microphone permission denied`, 'error');
            }
            updateSystemInfo();
        }

        function startSimpleVoice() {
            log('Starting simple voice recognition...');
            
            // Check if speech recognition is available
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                log('‚ùå Speech recognition not supported in this browser');
                updateStatus('‚ùå Speech recognition not supported', 'error');
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            
            try {
                recognition = new SpeechRecognition();
                log('‚úÖ Speech recognition object created');
                
                // Configure recognition
                recognition.continuous = true;
                recognition.interimResults = true;
                recognition.lang = 'en-US';
                
                log('‚úÖ Speech recognition configured');
                
                // Event handlers
                recognition.onstart = function() {
                    isListening = true;
                    log('üé§ Speech recognition STARTED');
                    updateStatus('üé§ Listening... Say "hello test" or "leslie test"', 'success');
                    document.getElementById('startBtn').style.display = 'none';
                    document.getElementById('stopBtn').style.display = 'inline-block';
                    updateSystemInfo();
                };
                
                recognition.onresult = function(event) {
                    let interimTranscript = '';
                    let finalTranscript = '';
                    
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        const transcript = event.results[i][0].transcript;
                        const confidence = event.results[i][0].confidence;
                        
                        if (event.results[i].isFinal) {
                            finalTranscript += transcript;
                            log(`üìù FINAL: "${transcript}" (confidence: ${confidence?.toFixed(2) || 'unknown'})`);
                            
                            // Check for test phrases
                            const lower = transcript.toLowerCase();
                            if (lower.includes('hello') || lower.includes('test') || lower.includes('leslie')) {
                                log(`üéØ TEST PHRASE DETECTED: "${transcript}"`);
                                updateStatus(`üéØ SUCCESS! Detected: "${transcript}"`, 'success');
                            }
                        } else {
                            interimTranscript += transcript;
                            log(`üìù INTERIM: "${transcript}"`);
                        }
                    }
                };
                
                recognition.onend = function() {
                    isListening = false;
                    log('üîÑ Speech recognition ENDED');
                    updateStatus('Speech recognition ended', 'warning');
                    document.getElementById('startBtn').style.display = 'inline-block';
                    document.getElementById('stopBtn').style.display = 'none';
                    updateSystemInfo();
                };
                
                recognition.onerror = function(event) {
                    isListening = false;
                    log(`‚ùå Speech recognition ERROR: ${event.error}`);
                    updateStatus(`‚ùå Error: ${event.error}`, 'error');
                    
                    if (event.error === 'not-allowed') {
                        log('‚ùå Microphone permission was denied');
                        updateStatus('‚ùå Microphone permission denied. Please allow and try again.', 'error');
                    }
                    
                    document.getElementById('startBtn').style.display = 'inline-block';
                    document.getElementById('stopBtn').style.display = 'none';
                    updateSystemInfo();
                };
                
                // Start recognition
                log('üöÄ Attempting to start speech recognition...');
                recognition.start();
                
            } catch (error) {
                log(`‚ùå Error creating speech recognition: ${error.message}`);
                updateStatus(`‚ùå Failed to start: ${error.message}`, 'error');
                updateSystemInfo();
            }
        }

        function stopVoice() {
            if (recognition && isListening) {
                try {
                    recognition.stop();
                    log('üõë Speech recognition stopped manually');
                } catch (error) {
                    log(`‚ùå Error stopping recognition: ${error.message}`);
                }
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            log('üöÄ Simple voice test ready');
            updateSystemInfo();
        });

        // Update system info every 2 seconds
        setInterval(updateSystemInfo, 2000);
    </script>
</body>
</html>
